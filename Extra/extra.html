<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DHKE: Troca de Chaves Diffie-Hellman</title>

    <link rel="icon" type="image/png" href="../logo_azul.png">
    
    <script src="../CSS/tailwind_local.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <link rel="stylesheet" href="../CSS/inter_local.css">

    <link rel="stylesheet" href="../CSS/estilo_main.css">
    
    <style>
        /* Estilos espec√≠ficos para a demonstra√ß√£o Diffie-Hellman */
        .dh-exchange-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        @media (max-width: 768px) {
            .dh-exchange-container {
                grid-template-columns: 1fr;
            }
        }

        .party-card {
            background-color: var(--color-bg-secondary);
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--color-accent-darker);
            min-height: 200px; /* Garante altura m√≠nima para alinhamento */
        }
        
        /* Estilo para a se√ß√£o do atacante, que ocupa a largura total */
        .attacker-card {
            grid-column: 1 / -1;
            background-color: #2C353D;
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
            border: 2px solid #ef4444; /* Vermelho para indicar amea√ßa */
            margin-top: 2rem;
        }

        .public-key-display {
            background-color: #1E252C;
            padding: 0.75rem;
            border-radius: 0.5rem;
            font-family: monospace;
            margin-top: 0.5rem;
            margin-bottom: 1rem;
            color: var(--color-accent-lighter);
            text-align: center;
        }

        .color-mix-result {
            height: 50px; /* Reduzido para dar espa√ßo ao novo conte√∫do */
            border-radius: 0.5rem;
            margin-top: 1rem;
            transition: background-color 0.5s ease-in-out;
            border: 2px solid var(--color-text);
        }

        .final-secret-display {
            font-size: 1.5rem;
            font-weight: bold;
            text-align: center;
            margin-top: 1rem;
        }

        /* Estilo para o Slider (Range Input) */
        input[type="range"] {
            width: 100%;
            height: 8px;
            background: #4A5568;
            border-radius: 5px;
            outline: none;
            opacity: 0.7;
            transition: opacity .2s;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--color-accent);
            cursor: pointer;
            box-shadow: 0 0 5px rgba(0, 182, 212, 0.5);
        }
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--color-accent);
            cursor: pointer;
            box-shadow: 0 0 5px rgba(0, 182, 212, 0.5);
        }

        /* Estilos de Status para o painel de ataque */
        .integrity-status {
            padding: 0.5rem;
            border-radius: 0.5rem;
            font-weight: bold;
            text-align: center;
            margin-top: 1rem;
        }
        .status-ok { background-color: #16A34A; color: #ECFDF5; }
        .status-fail { background-color: #DC2626; color: #FEF2F2; }
        .status-ok-light { background-color: #4B5563; color: #E5E7EB; }

    </style>
</head>
<body class="index-body">

    <div id="three-canvas"></div>

    <div class="navbar fixed top-0 left-0 right-0 z-20 shadow-lg navbar-transparent">
        <div class="navbar-content max-w-7xl mx-auto flex justify-between items-center py-4 px-6 relative z-10">
            <a href="../index.html" class="flex items-center space-x-2 text-2xl font-bold text-cyan-400 hover:text-cyan-300 transition">
                <img src="../logo_azul.png" alt="Logo" class="h-8 w-8">
                <span>CryptoInfo</span>
            </a>

            <button id="mobile-menu-toggle" class="p-2 rounded-md hover:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-cyan-400">
                <svg class="w-6 h-6 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
                </svg>
            </button>
        </div>
    </div>

    <div id="mobile-menu-drawer" class="mobile-menu-drawer transform transform-translate-x-full transition-transform duration-300 hidden">
        <h3 class="text-2xl font-bold mb-8 text-cyan-400 border-b border-slate-600 pb-2">Menu Principal</h3>

        <ul class="space-y-4 text-xl font-medium">
            <li><a href="../index.html" class="text-slate-200 hover:text-cyan-400 transition block py-2">Home</a></li>
            <li><a href="../Criptografia/criptografia.html" class="text-slate-200 hover:text-cyan-400 transition block py-2">Criptografia</a></li>
            
            <li class="pt-4"><span class="text-lg text-cyan-400 block border-t border-slate-600 pt-3 font-semibold">Cifras Sim√©tricas</span></li>
            <li><a href="../DES/main_des.html" class="text-slate-200 hover:text-cyan-400 transition block py-2 ml-4 text-base">Criptografia DES</a></li>
            <li><a href="../AES/main_aes.html" class="text-slate-200 hover:text-cyan-400 transition block py-2 ml-4 text-base">Criptografia AES</a></li>
            <li><a href="../Vigenere/vigenere.html" class="text-slate-200 hover:text-cyan-400 transition block py-2 ml-4 text-base">Cifra de Vigen√®re</a></li>
            
            <li class="pt-4"><span class="text-lg text-cyan-400 block border-t border-slate-600 pt-3 font-semibold">Criptografia de Chave P√∫blica</span></li>
            <li><a href="../RSA/rsa.html" class="text-slate-200 hover:text-cyan-400 transition block py-2 ml-4 text-base">Criptografia RSA</a></li>
            <li><a href="../ECC/ecc.html" class="text-slate-200 hover:text-cyan-400 transition block py-2 ml-4 text-base">Criptografia ECC</a></li>
            <li><a href="extra.html" class="text-slate-200 hover:text-cyan-400 transition block py-2 ml-4 text-base">Diffie-Hellman (DHKE)</a></li>

            <li class="pt-4"><span class="text-lg text-cyan-400 block border-t border-slate-600 pt-3 font-semibold">Ferramentas de Integridade</span></li>
            <li><a href="../Hashing/hashing.html" class="text-slate-200 hover:text-cyan-400 transition block py-2 ml-4 text-base">Fun√ß√µes Hash (SHA/MD5)</a></li>

            <li class="pt-4"><span class="text-lg text-cyan-400 block border-t border-slate-600 pt-3 font-semibold">Informa√ß√µes Adicionais</span></li>
            <li><a href="../SOBRE/sobre.html" class="text-slate-200 hover:text-cyan-400 transition block py-2 ml-4 text-base active">Sobre o Projeto</a></li>

        </ul>
    </div>

    <div id="mobile-menu-overlay" class="mobile-menu-overlay hidden opacity-0 transition-opacity duration-300" onclick="toggleMenu(false)"></div>


<section id="diffie-hellman" class="content-section-card max-w-7xl mx-auto mt-0">
    <h2 class="text-3xl font-extrabold text-white mb-4 border-b-2 border-cyan-500 pb-2">
        Troca de Chaves Diffie-Hellman (DHKE)
    </h2>
    
    <div class="bg-slate-800 p-5 rounded-xl shadow-xl border border-slate-700 mb-6">
        <h3 class="text-xl font-bold text-cyan-400 mb-2">Conceito e Relev√¢ncia</h3>
        <p class="text-slate-300 mb-4">
            O <strong class="text-yellow-300">Diffie-Hellman Key Exchange (DHKE)</strong> √© o primeiro m√©todo pr√°tico de <strong class="text-green-300">troca de chaves criptogr√°ficas</strong> sobre um canal inseguro, resolvendo o problema de como duas partes (Alice e Bob) podem concordar em um segredo m√∫tuo (<code class="text-yellow-300">S</code>) sem nunca terem se comunicado de forma privada antes. A sua principal relev√¢ncia reside na sua capacidade de permitir a <strong class="text-cyan-400">cria√ß√£o de um Segredo Compartilhado</strong> que pode ser usado para criptografar comunica√ß√µes subsequentes usando um algoritmo sim√©trico, como o AES.
        </p>
        <p class="text-slate-300">
            A seguran√ßa do DHKE depende da dificuldade computacional do <strong class="text-red-400">Problema do Logaritmo Discreto (DLP)</strong>. √â f√°cil realizar a exponencia√ß√£o modular (<code class="text-yellow-300">g<sup>a</sup> mod p</code>), mas √© <strong class="text-red-400">matematicamente invi√°vel</strong> para um atacante (Eve) reverter o processo e descobrir o segredo privado (<code class="text-red-400">a</code>) a partir da chave p√∫blica (<code class="text-cyan-300">A</code>).
        </p>
    </div>

    <p class="text-slate-300 mb-6">
        A simula√ß√£o demonstra como duas partes (Alice e Bob) estabelecem um <strong class="text-green-300">segredo compartilhado</strong> (<code class="text-yellow-300">S</code>) sobre um canal n√£o seguro.
    </p>
    
    <p class="text-sm text-slate-400 mb-6">
        <strong class="text-cyan-300">Par√¢metros P√∫blicos Fixos:</strong> <code class="text-yellow-300">g=5</code> (<code class="text-yellow-300">gerador</code>) e <code class="text-yellow-300">p=23</code> (<code class="text-yellow-300">m√≥dulo primo</code>). O <strong class="text-red-400">Segredo Privado</strong> (<code class="text-red-400">a</code>, <code class="text-red-400">b</code>) √© escolhido aleatoriamente no intervalo pequeno de <code class="text-yellow-300">[2, 15]</code> para fins did√°ticos.
    </p>

    <button onclick="runDiffieHellman()" class="button-with-shadow w-full max-w-sm mx-auto block mb-8 bg-cyan-600 hover:bg-cyan-500">
        Executar Nova Troca de Chaves
    </button>
    
    

    <div class="dh-exchange-container">
        <div class="party-card">
            <h3 class="text-xl font-bold text-cyan-400 mb-3">Alice</h3>
            <p>1. Secreto Privado Alice (<code class="text-red-400">a</code>): <span id="secretA" class="font-mono text-red-400">?</span></p>
            <p>2. <strong class="text-cyan-300">Chave P√∫blica Enviada</strong> <code class="text-cyan-300">A</code>:</p>
            <div class="text-sm text-slate-400 mb-1">F√≥rmula: <code class="text-yellow-300">A = g<sup>a</sup> mod p</code></div>
            <div id="publicKeyA" class="public-key-display text-green-300 font-mono">...</div>

            <h4 class="font-semibold mt-4">3. <strong class="text-green-400">Segredo Compartilhado</strong> <code class="text-yellow-300">S</code>:</h4>
            <div class="text-sm text-slate-400 mb-1">C√°lculo: <code class="text-yellow-300">S<sub>A</sub> = B<sup>a</sup> mod p</code></div>
            <p class="mt-1">Resultado: <span id="finalSecretA" class="final-secret-display text-green-400 font-mono">...</span></p>
            <div id="colorResultA" class="color-mix-result"></div>
        </div>

        <div class="party-card">
            <h3 class="text-xl font-bold text-cyan-400 mb-3">Bob</h3>
            <p>1. Secreto Privado Bob (<code class="text-red-400">b</code>): <span id="secretB" class="font-mono text-red-400">?</span></p>
            <p>2. <strong class="text-cyan-300">Chave P√∫blica Enviada</strong> <code class="text-cyan-300">B</code>:</p>
            <div class="text-sm text-slate-400 mb-1">F√≥rmula: <code class="text-yellow-300">B = g<sup>b</sup> mod p</code></div>
            <div id="publicKeyB" class="public-key-display text-green-300 font-mono">...</div>

            <h4 class="font-semibold mt-4">3. <strong class="text-green-400">Segredo Compartilhado</strong> <code class="text-yellow-300">S</code>:</h4>
            <div class="text-sm text-slate-400 mb-1">C√°lculo: <code class="text-yellow-300">S<sub>B</sub> = A<sup>b</sup> mod p</code></div>
            <p class="mt-1">Resultado: <span id="finalSecretB" class="final-secret-display text-green-400 font-mono">...</span></p>
            <div id="colorResultB" class="color-mix-result"></div>
        </div>
        
        <div class="attacker-card bg-slate-800 p-5 rounded-xl shadow-xl border border-red-700 col-span-full mt-8">
            <h3 class="text-2xl font-bold text-red-400 mb-4">Ataque de For√ßa Bruta (Eve)</h3>
            <p class="text-sm text-slate-400 mb-4">
                <strong class="text-yellow-300">Objetivo:</strong> Eve intercepta as <strong class="text-cyan-300">chaves p√∫blicas <code class="text-cyan-300">A</code> e <code class="text-cyan-300">B</code></strong> e tenta adivinhar o <strong class="text-red-400">Segredo Privado de Alice (<code class="text-red-400">a</code>)</strong>, resolvendo o <strong class="text-red-400">Problema do Logaritmo Discreto</strong>: <code class="text-red-400">a = log<sub>g</sub>A mod p</code>.
                Use o controle deslizante para testar todos os <code class="text-yellow-300">a</code> poss√≠veis (<code class="text-yellow-300">2 \le a \le 15</code>).
            </p>

            <div class="mb-4">
                <label for="eveGuess" class="block mb-2 font-semibold text-slate-200">
                    Tentativa de Secreto Privado <code class="text-red-400">a'</code> (Eve): <span id="eveGuessValue" class="text-cyan-400 font-mono">2</span>
                </label>
                <input type="range" id="eveGuess" min="2" max="15" value="2" oninput="checkEveGuess(this.value)">
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <p class="font-medium text-slate-300">Chave P√∫blica Real de Alice (<code class="text-cyan-300">A</code>):</p>
                    <div id="realKeyA_Eve" class="public-key-display text-cyan-400 font-mono">...</div>
                </div>
                <div>
                    <p class="font-medium text-slate-300">Chave P√∫blica Calculada por Eve (<code class="text-yellow-300">A'</code>):</p>
                    <div id="guessedKeyA_Eve" class="public-key-display text-yellow-400 font-mono">...</div>
                </div>
            </div>

            <div id="eveStatus" class="integrity-status mt-6 mb-4 text-center status-ok-light font-bold">Tente adivinhar o segredo privado 'a'...</div>
            
            <div class="flex space-x-4">
                <button onclick="revealSecrets()" id="revealBtn" class="button-with-shadow flex-1 bg-red-600 hover:bg-red-500">
                    Revelar Segredos Reais (<code class="text-yellow-300">a</code> e <code class="text-yellow-300">b</code>)
                </button>
                <button onclick="runDiffieHellman()" class="button-with-shadow flex-1 bg-slate-600 hover:bg-slate-500">
                    Nova Troca (Limpar Ataque)
                </button>
            </div>
        </div>
    </div>
    <p id="matchStatus" class="text-center mt-6 text-xl font-bold text-yellow-400"></p>
    
</section>


<hr class="border-slate-700 mt-12 mb-12">

<section id="zkp-section" class="content-section-card max-w-7xl mx-auto mt-0">
    <h2 class="text-3xl font-extrabold text-white mb-4 border-b-2 border-cyan-500 pb-2">
        Prova de Conhecimento Zero (Zero Knowledge Proof)
    </h2>

    <div class="mb-8">
        <p class="text-slate-300 mb-4 text-lg">
            A <strong class="text-cyan-400">Prova de Conhecimento Zero (ZKP)</strong> √© um protocolo criptogr√°fico revolucion√°rio que permite a uma parte (o <em class="text-yellow-300">Provador</em>) convencer outra parte (o <em class="text-green-300">Verificador</em>) de que ela conhece um segredo, sem jamais revelar o pr√≥prio segredo ou qualquer informa√ß√£o adicional sobre ele.
        </p>
        <p class="text-slate-300 text-lg">
            Imagine poder provar para um site que voc√™ tem a senha correta, sem nunca enviar a senha pela internet. Ou provar que voc√™ tem saldo suficiente para uma transa√ß√£o, sem revelar quanto dinheiro voc√™ tem.
        </p>
    </div>

    <div class="grid md:grid-cols-2 gap-6 mb-10">
        <div class="bg-slate-800 p-6 rounded-xl border border-slate-600 shadow-lg">
            <h4 class="text-xl font-bold text-cyan-400 mb-4 border-b border-slate-600 pb-2">As 3 Propriedades Fundamentais</h4>
            <ul class="list-disc list-inside text-slate-300 space-y-2">
                <li><strong class="text-white">Completude:</strong> Se a afirma√ß√£o for verdadeira, um verificador honesto sempre ser√° convencido.</li>
                <li><strong class="text-white">Corretude:</strong> Se a afirma√ß√£o for falsa, √© imposs√≠vel enganar o verificador (exceto por uma probabilidade √≠nfima).</li>
                <li><strong class="text-white">Conhecimento Zero:</strong> O verificador n√£o aprende nada al√©m do fato de que a afirma√ß√£o √© verdadeira.</li>
            </ul>
        </div>

        <div class="bg-slate-800 p-6 rounded-xl border border-purple-500 shadow-lg">
            <h3 class="text-xl font-bold text-purple-400 mb-4 border-b border-purple-500/30 pb-2">Aplica√ß√µes no Mundo Real</h3>
            <ul class="space-y-3 text-slate-300">
                <li class="flex items-start">
                    <span class="mr-2 text-purple-400 font-bold">‚ñ∏</span>
                    <span><strong>Blockchains de Privacidade:</strong> (Ex: Zcash, Monero) Permitem transa√ß√µes onde remetente, destinat√°rio e valor permanecem ocultos.</span>
                </li>
                <li class="flex items-start">
                    <span class="mr-2 text-purple-400 font-bold">‚ñ∏</span>
                    <span><strong>ZK-Rollups:</strong> Processam milhares de transa√ß√µes fora da rede principal e enviam apenas uma prova matem√°tica de validade.</span>
                </li>
                <li class="flex items-start">
                    <span class="mr-2 text-purple-400 font-bold">‚ñ∏</span>
                    <span><strong>Identidade Digital:</strong> Provar que voc√™ √© maior de idade sem revelar sua data de nascimento.</span>
                </li>
            </ul>
        </div>
    </div>

    <div class="bg-slate-800 p-6 rounded-xl shadow-xl border border-slate-700 mb-10">
        <h3 class="text-2xl font-bold text-cyan-400 mb-6 border-b border-slate-600 pb-2">A Caverna de Ali Bab√° (Analogia)</h3>
        <div class="grid md:grid-cols-3 gap-8 items-center">
            <div class="md:col-span-1 flex justify-center items-center">
                <div class="relative w-56 h-56 bg-slate-900 rounded-full border-4 border-slate-600 overflow-hidden shadow-inner">
                    <div class="absolute top-0 left-1/2 w-2 h-1/2 bg-slate-600 -translate-x-1/2"></div> <div class="absolute top-1/2 left-1/2 w-10 h-2 bg-yellow-500 -translate-x-1/2 translate-y-10 rounded shadow-[0_0_10px_rgba(234,179,8,0.8)]"></div> <div class="absolute bottom-6 left-6 text-cyan-300 font-bold text-2xl">A</div>
                    <div class="absolute bottom-6 right-6 text-green-300 font-bold text-2xl">B</div>
                    <div class="absolute bottom-2 left-1/2 -translate-x-1/2 text-slate-500 text-sm font-bold">Entrada</div>
                </div>
            </div>
            <div class="md:col-span-2 text-slate-300 leading-relaxed space-y-3 text-lg">
                <p>
                    Existe uma caverna circular com uma entrada e dois caminhos: <strong>Lado A</strong> e <strong>Lado B</strong>. No fundo, uma <strong>Porta M√°gica</strong> bloqueia a passagem entre A e B. A √∫nica forma de abrir a porta √© conhecendo a <strong>Palavra M√°gica (Segredo)</strong>.
                </p>
                <p>
                    <strong>Peggy (Provadora)</strong> quer provar para <strong>Victor (Verificador)</strong> que sabe a palavra m√°gica, sem revel√°-la.
                </p>
                <ol class="list-decimal list-inside space-y-2 ml-2 text-slate-300 bg-slate-900/50 p-4 rounded-lg">
                    <li>Victor espera fora. Peggy entra e escolhe um lado (A ou B) aleatoriamente.</li>
                    <li>Victor vai at√© a entrada e grita: "Saia pelo lado A!" (ou B).</li>
                    <li>Se Peggy souber a palavra m√°gica, ela abre a porta e sai pelo lado pedido.</li>
                    <li>Se ela <strong>n√£o</strong> souber, ela tem 50% de chance de errar.</li>
                </ol>
                <p class="text-yellow-300 font-medium">
                    Repetindo este evento v√°rias vezes, a chance de Peggy enganar Victor se tora estat√≠sticamente improv√°vel.
                </p>
            </div>
        </div>
    </div>

    <div class="bg-slate-900 p-8 rounded-xl border-2 border-cyan-600/50 shadow-2xl text-center relative overflow-hidden">
        <h3 class="text-2xl font-bold text-white mb-2">Demo Interativa: Teste a "Peggy"</h3>
        <p class="text-slate-400 mb-8 text-lg">
            Voc√™ √© o <strong>Verificador (Victor)</strong>. O Computador √© a <strong>Peggy</strong>.
            <br>O computador entrou na caverna e se escondeu. Grite por qual lado voc√™ quer que ele saia.
        </p>

        <div class="flex justify-center mb-10">
            <div class="w-full max-w-2xl h-20 bg-slate-800 rounded-lg flex items-center justify-between px-10 border border-slate-600 relative">
                <div class="text-cyan-500 font-bold text-2xl">Lado A</div>
                
                <div class="h-full w-2 bg-slate-600 mx-4"></div>
                
                <div class="text-green-500 font-bold text-2xl">Lado B</div>

                <div id="peggy-avatar" class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-12 h-12 bg-yellow-400 rounded-full shadow-[0_0_15px_rgba(250,204,21,0.6)] flex items-center justify-center text-slate-900 font-bold text-xl transition-all duration-700 opacity-0 z-10">
                    P
                </div>
            </div>
        </div>

        <div class="flex justify-center gap-8 mb-10">
            <button onclick="challengePeggy('A')" class="px-8 py-4 bg-cyan-900 hover:bg-cyan-700 border border-cyan-500 text-cyan-100 font-bold rounded-lg shadow-lg transition transform hover:scale-105 flex flex-col items-center">
                <span class="text-3xl mb-2">üó£Ô∏è</span>
                <span class="text-lg">"Saia pelo A!"</span>
            </button>
            <button onclick="challengePeggy('B')" class="px-8 py-4 bg-green-900 hover:bg-green-700 border border-green-500 text-green-100 font-bold rounded-lg shadow-lg transition transform hover:scale-105 flex flex-col items-center">
                <span class="text-3xl mb-2">üó£Ô∏è</span>
                <span class="text-lg">"Saia pelo B!"</span>
            </button>
        </div>

        <div class="max-w-xl mx-auto bg-slate-800 rounded-lg p-6 border border-slate-600">
            <p class="text-slate-400 text-sm mb-2 uppercase tracking-wide font-bold">Status da Rodada</p>
            <div id="zkp-status-text" class="text-xl font-mono font-bold text-white min-h-[1.75rem] mb-6">
                Peggy est√° escondida. Escolha um lado.
            </div>
            
            <div class="pt-6 border-t border-slate-600">
                <p class="text-xs text-slate-400 mb-2 uppercase tracking-widest font-bold">Confian√ßa Matem√°tica (1 - 1/2‚Åø)</p>
                <div class="w-full bg-slate-900 rounded-full h-4 mb-3 overflow-hidden border border-slate-700">
                    <div id="zkp-confidence-bar" class="bg-gradient-to-r from-cyan-500 to-green-500 h-full transition-all duration-500" style="width: 0%"></div>
                </div>
                <div class="flex justify-between items-end">
                    <p id="zkp-confidence-text" class="text-3xl font-bold text-white">0%</p>
                    <p id="zkp-rounds-text" class="text-slate-400 text-base font-medium">0 rodadas</p>
                </div>
            </div>
        </div>
        
        <button onclick="resetZkp()" class="mt-8 text-slate-500 hover:text-cyan-400 underline transition-colors">Reiniciar Experimento</button>
    </div>
</section>
    
    <script>
        // Envolve todo o c√≥digo JavaScript em um IIFE para isolar o escopo e evitar a
        // redeclara√ß√£o de vari√°veis globais.
        (function() {
            // Par√¢metros P√∫blicos
            const P = 23; // M√≥dulo Primo (p)
            const G = 5;  // Gerador (g)
            const MAX_SECRET = 15; // Limite superior para os n√∫meros secretos privados (a e b)
            const MIN_SECRET = 2; // Limite inferior

            // Objeto de Estado para manter os valores da troca atual
            let dhState = {
                secretoAlice: 0,
                secretoBob: 0,
                publicKeyA: 0,
                publicKeyB: 0,
                sharedSecret: 0,
            };

            /**
             * Implementa√ß√£o otimizada de exponencia√ß√£o modular (base^exp mod mod).
             * @param {number} base
             * @param {number} exponent
             * @param {number} modulus
             * @returns {number} O resultado de (base^exponent) mod modulus.
             */
            function power(base, exponent, modulus) {
                if (modulus === 1) return 0;
                let result = 1;
                base = base % modulus;
                while (exponent > 0) {
                    if (exponent % 2 === 1) {
                        result = (result * base) % modulus;
                    }
                    exponent = Math.floor(exponent / 2);
                    base = (base * base) % modulus;
                }
                return result;
            }

            /**
             * Mapeia um valor num√©rico (0 a P-1) para uma cor HSL.
             * @param {number} value - O valor do segredo compartilhado (0 a P-1).
             * @returns {string} - A string de cor HSL.
             */
            function mapValueToColor(value) {
                const hue = (value / P) * 360; 
                return `hsl(${hue}, 70%, 50%)`;
            }
            
            /**
             * Inicializa o painel do atacante.
             */
            function resetEvePanel() {
                const slider = document.getElementById('eveGuess');
                slider.min = MIN_SECRET;
                slider.max = MAX_SECRET;
                slider.value = MIN_SECRET;
                
                document.getElementById('eveGuessValue').textContent = MIN_SECRET;
                document.getElementById('realKeyA_Eve').textContent = dhState.publicKeyA;

                const eveStatus = document.getElementById('eveStatus');
                eveStatus.textContent = "Tente adivinhar o segredo privado 'a'... deslize!";
                eveStatus.className = "integrity-status status-ok-light"; // Reset class to default light

                // Calculate the public key for the initial guess (a=MIN_SECRET)
                document.getElementById('guessedKeyA_Eve').textContent = power(G, MIN_SECRET, P);

                document.getElementById('secretA').textContent = '?';
                document.getElementById('secretB').textContent = '?';
                document.getElementById('revealBtn').disabled = false;
            }

            /**
             * Executa toda a simula√ß√£o Diffie-Hellman.
             */
            function runDiffieHellman() {
                // 1. Escolha de segredos privados (a e b)
                // Garante que a e b estejam no intervalo [MIN_SECRET, MAX_SECRET]
                const secretoAlice = Math.floor(Math.random() * (MAX_SECRET - MIN_SECRET + 1)) + MIN_SECRET; 
                const secretoBob = Math.floor(Math.random() * (MAX_SECRET - MIN_SECRET + 1)) + MIN_SECRET; 

                // 2. C√°lculo das Chaves P√∫blicas (A e B)
                const publicKeyA = power(G, secretoAlice, P); // A = g^a mod p
                const publicKeyB = power(G, secretoBob, P); // B = g^b mod p

                // 3. C√°lculo do Segredo Compartilhado Final (S)
                // Alice recebe B (publicKeyB), calcula S = B^a mod p
                const sharedSecretAlice = power(publicKeyB, secretoAlice, P); 
                // Bob recebe A (publicKeyA), calcula S = A^b mod p
                const sharedSecretBob = power(publicKeyA, secretoBob, P);

                // Atualiza o estado da troca
                dhState = {
                    secretoAlice: secretoAlice,
                    secretoBob: secretoBob,
                    publicKeyA: publicKeyA,
                    publicKeyB: publicKeyB,
                    sharedSecret: sharedSecretAlice,
                };


                // 4. Atualiza√ß√£o da UI (Alice)
                document.getElementById('publicKeyA').textContent = publicKeyA;
                document.getElementById('finalSecretA').textContent = sharedSecretAlice;
                document.getElementById('colorResultA').style.backgroundColor = mapValueToColor(sharedSecretAlice);

                // 5. Atualiza√ß√£o da UI (Bob)
                document.getElementById('publicKeyB').textContent = publicKeyB;
                document.getElementById('finalSecretB').textContent = sharedSecretBob;
                document.getElementById('colorResultB').style.backgroundColor = mapValueToColor(sharedSecretBob);
                
                // 6. Verifica√ß√£o e Status
                const matchStatus = document.getElementById('matchStatus');
                if (sharedSecretAlice === sharedSecretBob) {
                    matchStatus.textContent = `‚úÖ Segredo Compartilhado (S=${sharedSecretAlice}) √© ID√äNTICO.`;
                    matchStatus.classList.remove('text-red-400');
                    matchStatus.classList.add('text-green-400');
                } else {
                    matchStatus.textContent = `‚ùå Segredos N√ÉO correspondem! (Erro interno na simula√ß√£o)`;
                    matchStatus.classList.remove('text-green-400');
                    matchStatus.classList.add('text-red-400');
                }

                // 7. Reseta e Inicializa o Painel do Atacante (Eve)
                resetEvePanel();
            }

            /**
             * Fun√ß√£o para a Eve tentar adivinhar o segredo 'a' de Alice.
             * @param {string} guessedSecretoAliceString - O segredo privado (a) que Eve est√° testando.
             */
            function checkEveGuess(guessedSecretoAliceString) {
                const guessedSecretoAlice = parseInt(guessedSecretoAliceString, 10);
                document.getElementById('eveGuessValue').textContent = guessedSecretoAlice;

                const guessedKeyA_Eve = document.getElementById('guessedKeyA_Eve');
                const eveStatus = document.getElementById('eveStatus');
                
                // 1. Eve calcula a chave p√∫blica A' = g^a' mod p
                const A_prime = power(G, guessedSecretoAlice, P); 
                guessedKeyA_Eve.textContent = A_prime;
                
                // 2. Compara A' com a chave p√∫blica real A
                if (A_prime === dhState.publicKeyA) {
                    // Eve encontrou o segredo!
                    
                    // Eve agora calcula o segredo compartilhado S
                    const S_Eve = power(dhState.publicKeyB, guessedSecretoAlice, P);
                    
                    eveStatus.textContent = `üö® SUCESSO! Logaritmo Discreto resolvido! a = ${guessedSecretoAlice}. Segredo Compartilhado (S=${S_Eve}) Descoberto!`;
                    eveStatus.className = "integrity-status status-fail";
                    
                    document.getElementById('realKeyA_Eve').textContent = `${dhState.publicKeyA} (SEGURAN√áA QUEBRADA!)`;
                    
                } else {
                    // Tentativa incorreta
                    eveStatus.textContent = `Tentativa ${guessedSecretoAlice} falhou. A' (${A_prime}) ‚â† A Real (${dhState.publicKeyA})`;
                    eveStatus.className = "integrity-status status-ok-light";
                }
            }

            /**
             * Revela os segredos privados reais para fins educacionais.
             */
            function revealSecrets() {
                document.getElementById('secretA').textContent = dhState.secretoAlice;
                document.getElementById('secretB').textContent = dhState.secretoBob;
                document.getElementById('eveStatus').textContent = `Os segredos eram a=${dhState.secretoAlice} e b=${dhState.secretoBob}.`;
                document.getElementById('eveStatus').className = "integrity-status status-ok";
                document.getElementById('revealBtn').disabled = true;
            }
            
            // Atribui as fun√ß√µes ao escopo global para que os bot√µes e o slider possam encontr√°-las
            window.runDiffieHellman = runDiffieHellman;
            window.checkEveGuess = checkEveGuess;
            window.revealSecrets = revealSecrets;

            // Roda a simula√ß√£o na primeira carga para inicializar a tela
            document.addEventListener('DOMContentLoaded', runDiffieHellman);
        })(); // O IIFE √© invocado imediatamente
    </script>

   <script>
    // =======================================================
    // L√ìGICA ZKP: CAVERNA DE ALI BAB√Å
    // =======================================================
    
    let zkpRounds = 0;
    let peggySide = null; // 'A' ou 'B' (Onde a Peggy realmente entrou)
    let isAnimating = false;

    // Inicializa a primeira rodada "escondendo" a Peggy
    function hidePeggy() {
        peggySide = Math.random() < 0.5 ? 'A' : 'B';
        const avatar = document.getElementById('peggy-avatar');
        avatar.style.opacity = '0'; 
        avatar.textContent = "?";
        // Reseta posi√ß√£o visualmente para o centro
        avatar.style.left = '50%';
    }

    // Inicia o desafio
    function challengePeggy(requestedSide) {
        if (isAnimating) return;
        isAnimating = true;

        const statusText = document.getElementById('zkp-status-text');
        const avatar = document.getElementById('peggy-avatar');

        statusText.textContent = `Voc√™ gritou: "Saia pelo ${requestedSide}!"...`;
        statusText.className = "text-lg font-mono font-bold text-yellow-300 mb-4";

        // Simula o tempo de rea√ß√£o da Peggy
        setTimeout(() => {
            // Peggy sempre "sabe" o segredo nesta simula√ß√£o, ent√£o ela sempre consegue sair pelo lado correto.
            // Se ela estava em A e pediram B, ela usa a porta m√°gica.
            // Visualmente, fazemos ela aparecer no lado solicitado.
            
            avatar.style.opacity = '1';
            avatar.textContent = "P";
            
            // Define a posi√ß√£o visual baseada no pedido (mostrando que ela saiu por l√°)
            if (requestedSide === 'A') {
                avatar.style.left = '15%'; // Posi√ß√£o visual do lado A
                avatar.className = "absolute top-1/2 -translate-y-1/2 w-10 h-10 bg-cyan-500 rounded-full shadow-[0_0_15px_rgba(6,182,212,0.8)] flex items-center justify-center text-white font-bold transition-all duration-700 opacity-100";
            } else {
                avatar.style.left = '85%'; // Posi√ß√£o visual do lado B
                avatar.className = "absolute top-1/2 -translate-y-1/2 w-10 h-10 bg-green-500 rounded-full shadow-[0_0_15px_rgba(34,197,94,0.8)] flex items-center justify-center text-white font-bold transition-all duration-700 opacity-100";
            }

            // Feedback de sucesso
            statusText.textContent = `Sucesso! Peggy saiu pelo lado ${requestedSide}.`;
            statusText.className = "text-lg font-mono font-bold text-green-400 mb-4";

            // Atualiza matem√°tica
            updateZkpStats();

            // Prepara pr√≥xima rodada
            setTimeout(() => {
                isAnimating = false;
                hidePeggy();
                statusText.textContent = "Peggy se escondeu novamente. Escolha um lado.";
                statusText.className = "text-lg font-mono font-bold text-white mb-4";
            }, 2000);

        }, 600);
    }

    function updateZkpStats() {
        zkpRounds++;
        // F√≥rmula: 1 - (1/2)^N
        const confidence = (1 - Math.pow(0.5, zkpRounds)) * 100;
        
        // UI Update
        document.getElementById('zkp-confidence-bar').style.width = `${confidence}%`;
        
        let confidenceString = confidence < 99.9 ? confidence.toFixed(2) : "99.99";
        if (zkpRounds > 12) confidenceString = "99.999...";
        
        document.getElementById('zkp-confidence-text').textContent = `${confidenceString}%`;
        document.getElementById('zkp-rounds-text').textContent = `${zkpRounds} rodadas`;
    }

    function resetZkp() {
        zkpRounds = 0;
        document.getElementById('zkp-confidence-bar').style.width = '0%';
        document.getElementById('zkp-confidence-text').textContent = '0%';
        document.getElementById('zkp-rounds-text').textContent = '0 rodadas';
        hidePeggy();
        document.getElementById('zkp-status-text').textContent = "Peggy est√° escondida. Escolha um lado.";
    }

    // Inicializa
    document.addEventListener('DOMContentLoaded', hidePeggy);
</script>
    
    <script src="../JS/main.js"></script>
</body>

</html>

